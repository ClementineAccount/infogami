$def with (page)

$var title: $_.EDIT $page.name

$add_javascript('/files/core/repetition/repetition-model.js')

<pre>

Primitive ui for schema.

Append * to type to support plural values.

Supported types:
    integer
    string
    thing type
</pre>

<script>
function changeTemplate() {
    var t = document.edit._type.value;
    document.location.href += '&t=' + t;
}


function element(tag, attrs) {
    var e = document.createElement(tag);

    for (var key in attrs) {
        e[key] = attrs[key];
    }
    return e;
}

function input(type, name, value) {
   return element('input', {type: type, name: name, value: value});
}

function hidden(name, value) {
   return input('hidden', name, value);
}

function submit(action) {
    var inputs = document.inputform.elements;
    for (var i=0; i<inputs.length; i+=3) {
        var k = inputs[i].value;
        var v = inputs[i+1].value;
        
        // ignore empty items. (how to strip?)
        if (k != "" && v != "")
            document.edit.appendChild(hidden(k, v));
    }
    document.edit.appendChild(hidden(action, action));
    document.edit.submit();
}

</script>

<form name="edit" method="POST">

<strong>$_.PAGETYPE</strong> <input type="text" name="_type" value="$page.type.name" />
<input type="button" onclick="changeTemplate()" value="$_.CHANGE"/><br /><br />
</form>

<form name="inputform">
<table id>
    <thead>
    <tr>
    <th>Name</th>
    <th>Type</th>
    </thead>
    <tbody>
$ i = 0

$for key in page.d.keys():
    $ i = i + 1
    <tr repeat="$i">
      <td><input type="text" id="key$i" name="key$i" value="$key"></td>
      <td><input type="text" id="value$i" name="value$i" value="$page.d[key]"></td>
      <td><button type="remove">Remove This Row</button></td>
    </tr>

    <tr id="order" repeat="template">
      <td><input type="text" id="key[order]" name="key[order]" value=""></td>
      <td><input type="text" id="value[order]" name="value[order]" value=""></td>
      <td><button type="remove">Remove This Row</button></td>
    </tr>
</tbody>
</table>
</form>

<p><button type="add" template="order">Add Row</button></p>
<input type="submit" value="Save" onclick="javascript:submit('_save');">
<input type="submit" value="Preview" onclick="javascript:submit('_preview');">
<input type="submit" value="Delete" onclick="javascript:submit('_delete');">

